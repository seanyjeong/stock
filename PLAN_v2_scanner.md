# 종목 추천 시스템 v2 개선 플랜

## 현재 상태 (v1)
- `day_trader_scanner.py` - 단타 추천 (RSI, MACD, 볼린저)
- `swing_long_scanner.py` - 스윙/장기 추천 (기술적 지표)
- **문제점:**
  - 차트/모멘텀만 분석, 뉴스/호재/악재 미반영
  - 추천 매수가 = 전 거래일 종가 (단순)
  - 추천 이유 불명확
  - 투자성향 미반영

---

## v2 개선 목표

### 1. 종합 분석 로직
**분석 항목:**
- [ ] 기술적 지표 (RSI, MACD, 볼린저, 이평선)
- [ ] 뉴스 분석 (SEC EDGAR 호재/악재)
- [ ] 센티먼트 (Stocktwits, 소셜)
- [ ] 공매도 데이터 (SI%, BR%, RegSHO)
- [ ] 펀더멘털 (PER, PBR, 성장률) - 장기용
- [ ] 거래량 이상 징후
- [ ] 52주 신고가/신저가 근접

**종합 점수 산출:**
```
단타 점수 = 기술적(40%) + 뉴스(20%) + 모멘텀(25%) + 거래량(15%)
스윙 점수 = 기술적(30%) + 뉴스(25%) + 펀더멘털(20%) + 센티먼트(25%)
장기 점수 = 펀더멘털(40%) + 성장성(30%) + 뉴스(15%) + 밸류에이션(15%)
```

### 2. 스마트 매수가 계산
**현재:** 전 거래일 종가
**개선:**
- [ ] 지지선/저항선 분석
- [ ] 피보나치 되돌림
- [ ] 최근 거래량 가중 평균가
- [ ] 갭 분석 (갭업/갭다운 시 조정)
- [ ] ATR 기반 변동성 고려

**매수가 타입:**
```
- 공격적 매수가: 현재가 근처 (빠른 진입)
- 보수적 매수가: 지지선 근처 (안전 진입)
- 분할매수 제안: [1차: X$, 2차: Y$, 3차: Z$]
```

### 3. 추천 이유 (한글 상세)
**출력 형식:**
```
[단타 추천] BNAI
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 기술적 분석
- RSI 32 → 과매도 구간 진입
- MACD 골든크로스 임박
- 볼린저밴드 하단 터치 후 반등

📰 뉴스/이슈
- SEC에 partnership 공시 3건 (호재)
- 악재 없음

📈 모멘텀
- 거래량 전일 대비 +340%
- 5일 연속 상승 후 눌림목

💡 추천 이유
"과매도 구간에서 강한 거래량 동반 반등 시도.
SEC 호재 공시와 함께 단기 상승 모멘텀 예상."

💰 추천 매수가
- 공격적: $12.50 (현재가)
- 보수적: $11.80 (지지선)
- 손절가: $10.50 (-12%)
- 목표가: $15.00 (+20%)
```

### 4. AI 자가 검증
**검증 항목:**
- [ ] "이 가격에 매수가 합리적인가?" → 밸류에이션 체크
- [ ] "리스크 대비 수익이 적절한가?" → Risk/Reward 비율
- [ ] "시장 상황에 맞는 추천인가?" → 시장 지수 트렌드
- [ ] "과거 유사 패턴 성공률?" → 백테스트 (선택)

**검증 실패 시:**
```
⚠️ 자가검증 경고
- 현재 시장 하락 추세로 단타 리스크 높음
- Risk/Reward 비율 1:1.2로 낮음
→ 추천 등급 하향 조정 (★★★ → ★★)
```

### 5. 투자성향 프로파일링

**첫 로그인 시 설문:**
```
Q1. 투자 경험
- 1년 미만 / 1-3년 / 3년 이상

Q2. 손실 허용 범위
- 5% 미만 / 10% 미만 / 20% 미만 / 20% 이상

Q3. 투자 기간 선호
- 단타 (1-3일) / 스윙 (1-2주) / 장기 (1개월+) / 혼합

Q4. 수익 기대
- 안정적 5-10% / 중간 10-30% / 공격적 30%+

Q5. 관심 섹터
- 기술주 / 바이오 / 에너지 / 금융 / 전체
```

**성향 분류:**
- 🛡️ 안정형: 장기 위주, 우량주, 분할매수
- ⚖️ 균형형: 스윙 + 장기 혼합
- 🔥 공격형: 단타 + 스윙, 고변동성 종목

**DB 저장:**
```sql
ALTER TABLE users ADD COLUMN investment_style JSONB;
-- {
--   "type": "aggressive",
--   "risk_tolerance": 20,
--   "preferred_duration": "swing",
--   "sectors": ["tech", "bio"],
--   "updated_at": "2026-01-25"
-- }
```

### 6. 성향 재설정
- 내 정보 페이지에 "투자성향 다시하기" 버튼
- 언제든 재설정 가능
- 변경 시 추천 알고리즘 즉시 반영

---

## 구현 순서

### Phase 1: 투자성향 시스템
1. [ ] DB 스키마 추가 (investment_style)
2. [ ] 온보딩 설문 API
3. [ ] 온보딩 프론트엔드 페이지
4. [ ] 내 정보에 성향 표시 + 다시하기

### Phase 2: 추천 로직 고도화
1. [ ] 뉴스 분석 통합 (SEC EDGAR 데이터 활용)
2. [ ] 종합 점수 산출 함수
3. [ ] 스마트 매수가 계산
4. [ ] 한글 추천 이유 생성

### Phase 3: AI 자가 검증
1. [ ] 밸류에이션 체크 로직
2. [ ] Risk/Reward 계산
3. [ ] 시장 상황 체크
4. [ ] 검증 실패 시 등급 조정

### Phase 4: 프론트엔드
1. [ ] 추천 카드 UI 리뉴얼
2. [ ] 상세 분석 모달
3. [ ] 성향별 필터링

---

## 파일 구조
```
├── scanners/
│   ├── base_scanner.py      # 공통 분석 함수
│   ├── day_scanner.py       # 단타 v2
│   ├── swing_scanner.py     # 스윙 v2
│   └── long_scanner.py      # 장기 v2
├── analysis/
│   ├── news_analyzer.py     # 뉴스 분석
│   ├── sentiment.py         # 센티먼트
│   ├── technicals.py        # 기술적 지표
│   └── fundamentals.py      # 펀더멘털
├── api/
│   ├── onboarding.py        # 투자성향 설문
│   └── recommendations.py   # 추천 API
└── web/src/routes/
    └── onboarding/+page.svelte
```

---

## 주의사항
- "얼탱이 없게" = 추천이 말이 되어야 함
- 모든 추천에 명확한 이유 제시
- 사용자 성향에 맞지 않으면 추천하지 않음
- 자가검증 실패 시 솔직하게 경고
